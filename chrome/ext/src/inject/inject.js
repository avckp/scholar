function sendSelection(){selected=window.getSelection().toString(),""!=selected&&selected.length>0&&(console.log("Lets"+selected+URL),port.postMessage({text:selected,URL:URL,title:title}))}function sendOnce(e,n){port.postMessage({text:"init",URL:e,title:n}),console.log("Fired")}chrome.runtime?chrome.runtime.onMessage||(chrome.runtime.onMessage=chrome.extension.onMessage,chrome.runtime.sendMessage=chrome.extension.sendMessage,chrome.runtime.onConnect=chrome.extension.onConnect,chrome.runtime.connect=chrome.extension.connect):chrome.runtime=chrome.extension;var URL,title;window.onload=function(){console.log("Hi from the injected page."),URL=document.URL,title=document.title};var port=chrome.runtime.connect({name:"mycontentscript"});port.postMessage({greeting:"Calling you from Inject script. If this works I can pass random things from here."}),port.onMessage.addListener(function(e){console.log(e),"hello"===e.greeting&&console.log(e.greeting)}),document.addEventListener("dragend",sendSelection);